#include QMK_KEYBOARD_H
//#include "ps2_mouse.h"
#include "blackpill_f411.h"


enum custom_keycodes {
  KKC_1
};

// MATRIX related stuff ===================================

#define LAYOUT_all(                                                                                                                        \
  K00  ,        K02  , K03  , K04  , K05  , K06  , K07  ,    K010 , K011 , K012 , K013 ,     K014 ,                                             \
                K12  , K13  , K14  , K15  , K16  , K17  ,    K110 , K111 , K112 , K113 ,                            K115 , K116 , K117 , K118 , \
                                                                                                                                                \
  K20  , K21  , K22  , K23  , K24  , K25  , K26  , K27  , K28  , K29  , K210 , K211 , K212 , K213 , K214 ,          K215 , K216 , K217 , K218 , \
  K30  , K31  , K32  , K33  , K34  , K35  , K36  , K37  , K38  , K39  , K310 , K311 , K312 , K313 , K314 ,          K315 , K316 , K317 , K318 , \
  K40  , K41  , K42  , K43  , K44  , K45  , K46  , K47  , K48  , K49  , K410 , K411 , K412 , K413 , K414 ,          K415 , K416 , K417 , K418 , \
  K50  , K51  , K52  , K53  , K54  , K55  , K56  , K57  , K58  , K59  , K510 , K511 , K512 , K513 ,    K514 ,       K515 , K516 , K517 , K518 , \
  K60  , K61  , K62  , K63  , K64  , K65  , K66  , K67  , K68  , K69  , K610 , K611 , K612 ,    K613 , K614 , K615                              \
)                                                                                                                                               \
{                                                                                                                                               \
  { K00  , KC_NO, K02  , K03  , K04  , K05  , K06  , K07  , KC_NO, KC_NO, K010 , K011 , K012 , K013 , K014 , KC_NO, KC_NO, KC_NO, KC_NO},       \
  { KC_NO, KC_NO, K12  , K13  , K14  , K15  , K16  , K17  , KC_NO, KC_NO, K110 , K111 , K112 , K113 , KC_NO, K115 , K116 , K117 , K118 },       \
  { K20  , K21  , K22  , K23  , K24  , K25  , K26  , K27  , K28  , K29  , K210 , K211 , K212 , K213 , K214 , K215 , K216 , K217 , K218 },       \
  { K30  , K31  , K32  , K33  , K34  , K35  , K36  , K37  , K38  , K39  , K310 , K311 , K312 , K313 , K314 , K315 , K316 , K317 , K318 },       \
  { K40  , K41  , K42  , K43  , K44  , K45  , K46  , K47  , K48  , K49  , K410 , K411 , K412 , K413 , K414 , K415 , K416 , K417 , K418 },       \
  { K50  , K51  , K52  , K53  , K54  , K55  , K56  , K57  , K58  , K59  , K510 , K511 , K512 , K513 , K514 , K515 , K516 , K517 , K518 },       \
  { K60  , K61  , K62  , K63  , K64  , K65  , K66  , K67  , K68  , K69  , K610 , K611 , K612 , K613 , K614 , K615 , KC_NO, KC_NO, KC_NO}        \
}

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  /*
  * [TEMPLATE]
  *
  * ┌───┐   ┌───┬───┬───┬───┬───┬───┐  ┌───┬───┬───┬───┐  ┌───┐     ┌───┬───┬───┬───┐
  * │   │   │   │   │   │   │   │   │  │   │   │   │   │  │   │     │   │   │   │   │
  * └───┘   ├───┼───┼───┼───┼───┼───┤  ├───┼───┼───┼───┤  └───┘     ├───┼───┼───┼───┤
  *         │   │   │   │   │   │   │  │   │   │   │   │            │   │   │   │   │
  *         └───┴───┴───┴───┴───┴───┘  └───┴───┴───┴───┘            ├───┼───┼───┼───┤
  *                                                                 │   │   │   │   │
  * ┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐   ├───┼───┼───┼───┤
  * │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤   ├───┼───┼───┼───┤
  * │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤   └───┴───┴───┴───┘
  * │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┘
  * │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ┌───┐
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┘ │   │
  * │   │   │   │   │   │   │   │   │   │   │   │   │   │ ┌───┼───┼───┐
  * └───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘ │   │   │   │
  *                                                       └───┴───┴───┘
  */

  /*
  * [TEST]
  *
  * ┌───┐   ┌───┬───┬───┬───┬───┬───┐  ┌───┬───┬───┬───┐  ┌───┐     ┌───┬───┬───┬───┐
  * │ A │   │ B │ C │ D │ E │ F │ G │  │ H │ I │ J │ K │  │ L │     │ M │ N │ O │ P │
  * └───┘   ├───┼───┼───┼───┼───┼───┤  ├───┼───┼───┼───┤  └───┘     ├───┼───┼───┼───┤
  *         │ Q │ R │ S │ T │ U │ V │  │ W │ X │ Y │ Z │            │ 0 │ 1 │ 2 │ 3 │
  *         └───┴───┴───┴───┴───┴───┘  └───┴───┴───┴───┘            ├───┼───┼───┼───┤
  *                                                                 │ 4 │ 5 │ 6 │ 7 │
  * ┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐   ├───┼───┼───┼───┤
  * │ 0 │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 │ A │ B │ C │ D │ E │   │ 8 │ 9 │ A │ B │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤   ├───┼───┼───┼───┤
  * │ F │ G │ H │ I │ J │ K │ L │ M │ N │ O │ P │ Q │ R │ S │ T │   │ C │ D │ E │ F │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤   └───┴───┴───┴───┘
  * │ U │ V │ W │ X │ Y │ Z │ 0 │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┘
  * │ 9 │ A │ B │ C │ D │ E │ F │ G │ H │ I │ J │ K │ L │ M │ ┌───┐
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┘ │ N │
  * │ O │ P │ Q │ R │ S │ T │ U │ V │ W │ X │ Y │ Z │ 0 │ ┌───┼───┼───┐
  * └───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘ │ 1 │ 2 │ 3 │
  *                                                       └───┴───┴───┘
  */

  [0] = LAYOUT_all(
    KC_A,       KC_B, KC_C, KC_D, KC_E, KC_F, KC_G,             KC_H, KC_I, KC_J, KC_K, KC_L, 
                KC_Q, KC_R, KC_S, KC_T, KC_U, KC_V,             KC_W, KC_X, KC_Y, KC_Z,       KC_M, KC_N, KC_O, KC_P,
    KC_0, KC_1, KC_2, KC_3, KC_4, KC_5, KC_6, KC_7, KC_8, KC_9, KC_A, KC_B, KC_C, KC_D, KC_E, KC_0, KC_1, KC_2, KC_3,
    KC_F, KC_G, KC_H, KC_I, KC_J, KC_K, KC_L, KC_M, KC_N, KC_O, KC_P, KC_Q, KC_R, KC_S, KC_T, KC_4, KC_5, KC_6, KC_7,
    KC_U, KC_V, KC_W, KC_X, KC_Y, KC_Z, KC_0, KC_1, KC_2, KC_3, KC_4, KC_5, KC_6, KC_7, KC_8, KC_8, KC_9, KC_A, KC_B,
    KC_9, KC_A, KC_B, KC_C, KC_D, KC_E, KC_F, KC_G, KC_H, KC_I, KC_J, KC_K, KC_L, KC_M, KC_N, KC_C, KC_D, KC_E, KC_F,
    KC_O, KC_P, KC_Q, KC_R, KC_S, KC_T, KC_U, KC_V, KC_W, KC_X, KC_Y, KC_Z, KC_0, KC_1, KC_2, KC_3
  )

  /*
  * [BASIC]
  *
  * ┌───┐   ┌───┬───┬───┬───┬───┬───┐  ┌───┬───┬───┬───┐  ┌───┐     ┌───┬───┬───┬───┐
  * │ESC│   │F1 │F2 │F3 │F4 │F5 │F6 │  │BUP│VUP│>||│PUP│  │RST│     │   │   │   │   │
  * └───┘   ├───┼───┼───┼───┼───┼───┤  ├───┼───┼───┼───┤  └───┘     ├───┼───┼───┼───┤
  *         │F7 │F8 │F9 │F10│F11│F12│  │BDN│VDN│CLC│PDN│            │   │   │   │   │
  *         └───┴───┴───┴───┴───┴───┘  └───┴───┴───┴───┘            ├───┼───┼───┼───┤
  *                                                                 │   │   │   │   │
  * ┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐   ├───┼───┼───┼───┤
  * │   │F13│F14│F15│F16│F17│F18│F19│F20│F21│F22│F23│F24│CPY│PST│   │   │   │   │   │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤   ├───┼───┼───┼───┤
  * │UDO│Tab│ Q │ W │ E │ R │ T │ Y │ U │ I │ O │ P │<--│CUT│ALL│   │   │   │   │   │
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤   └───┴───┴───┴───┘
  * │RDO│L_1│ A │ S │ D │ F │ G │ H │ J │ K │ L │ ; │Ent│PSc│Ins│
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┘
  * │   │Shf│ Z │ X │ C │ V │ B │ N │ M │ , │ . │ / │Shf│   │ ┌───┐
  * ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┘ │ ⬆ │
  * │   │Ctr│Win│Del│Alt│SPC│L_2│L_3│<--│Alt│Del│Men│Ctr│ ┌───┼───┼───┐
  * └───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘ │ ← │ ⬇ │ → │
  *                                                       └───┴───┴───┘
  */

};

enum oled_states {
  OLED_TEXT,
  OLED_TEST
};

int oled_state = OLED_TEXT;

// bool process_record_user(uint16_t keycode, keyrecord_t *record) {
//   float my_song[][2] = SONG(GUITAR_SOUND);
//   static bool pressEven = false;

//   if (record->event.pressed) {
//     switch (keycode) {
//       case KKC_1:
//         setIndicatorsState((uint8_t)((pressEven) ? LED_ALL_R : LED_ALL_G));
//         oled_state = (pressEven) ? OLED_TEXT : OLED_TEST;
//         showIndicators();
//         pressEven = !pressEven;
//         SEND_STRING(SS_TAP(X_A));
//         PLAY_SONG(my_song);
//         break;
//     }
//   }
//   return true;
// }

void keyboard_post_init_kb(void) {
  //ps2_mouse_set_resolution(PS2_MOUSE_1_COUNT_MM);
  //ps2_mouse_set_sample_rate(PS2_MOUSE_10_SAMPLES_SEC);
  debug_enable=true;
  debug_matrix=true;
  debug_keyboard=false;
  debug_mouse=false;
}

#ifdef OLED_ENABLE
bool oled_task_user(void)
{
  static const char test_image [] PROGMEM = {
    // 'Test_image_128x32', 128x32px
    0xff, 0x11, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 
    0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 
    0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 
    0x01, 0x07, 0x01, 0x09, 0x11, 0x21, 0x43, 0x81, 0x01, 0x01, 0x01, 0x47, 0xe1, 0x01, 0x21, 0xa1, 
    0x43, 0x01, 0x41, 0xa1, 0x41, 0x07, 0x01, 0x01, 0x81, 0x41, 0x23, 0x11, 0x09, 0x01, 0x01, 0x07, 
    0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 
    0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 
    0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x07, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x11, 0xff, 
    0xff, 0x42, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x40, 0xa0, 0x20, 0x00, 0x40, 0xa0, 0x20, 0x00, 0xe0, 0x20, 0xc0, 0x00, 0x40, 0xe0, 0x00, 0xa0, 
    0xa0, 0x40, 0x00, 0xc0, 0x20, 0xc0, 0x00, 0xc0, 0xa1, 0x22, 0x04, 0x08, 0x13, 0x20, 0x43, 0x82, 
    0x82, 0x40, 0x21, 0x12, 0x09, 0x04, 0xa2, 0xa1, 0x40, 0x00, 0x20, 0xa0, 0x40, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x02, 0x01, 0x01, 0x18, 0x06, 0x01, 0x00, 0x1f, 
    0x11, 0x1f, 0x00, 0x1f, 0x00, 0x1f, 0x04, 0x0a, 0x11, 0x00, 0x1f, 0x15, 0x1b, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x42, 0xff, 
    0xff, 0x08, 0x08, 0x00, 0x00, 0xf0, 0x10, 0x90, 0x90, 0x60, 0x00, 0xf0, 0x90, 0x90, 0x10, 0x10, 
    0x00, 0xf0, 0x10, 0x90, 0x90, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0xe0, 
    0x02, 0x02, 0x01, 0x00, 0x02, 0x02, 0x01, 0x00, 0x03, 0x02, 0x01, 0x00, 0x00, 0x03, 0x00, 0x02, 
    0x02, 0x01, 0x00, 0x01, 0x02, 0x01, 0x00, 0x01, 0x82, 0x41, 0x20, 0x10, 0x88, 0x04, 0x82, 0x81, 
    0x01, 0x02, 0x04, 0x88, 0x90, 0x20, 0x42, 0x82, 0x01, 0x00, 0x03, 0x02, 0x02, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xe0, 0x98, 0x84, 0xa2, 
    0x82, 0x82, 0x82, 0x82, 0x82, 0xa2, 0x84, 0x98, 0xe0, 0x80, 0x80, 0x00, 0x00, 0x08, 0x08, 0xff, 
    0xff, 0xa1, 0xa0, 0x80, 0xc0, 0x87, 0x84, 0x84, 0x84, 0xe3, 0x80, 0x87, 0x80, 0x80, 0xc0, 0x80, 
    0x80, 0x87, 0x84, 0xe4, 0x84, 0x83, 0x80, 0x80, 0xc0, 0x86, 0x86, 0x87, 0x87, 0xe3, 0x80, 0x83, 
    0x87, 0x87, 0xc6, 0x82, 0x80, 0x80, 0x80, 0xe0, 0x80, 0x80, 0x80, 0x80, 0xc0, 0x80, 0x80, 0x80, 
    0x80, 0xe0, 0x80, 0x90, 0x88, 0x84, 0xc2, 0x81, 0x80, 0x80, 0x80, 0xe0, 0x8f, 0x80, 0x8c, 0x8a, 
    0xc9, 0x80, 0x87, 0x88, 0x88, 0xe0, 0x80, 0x80, 0x81, 0x82, 0xc4, 0x88, 0x90, 0x80, 0x80, 0xe0, 
    0x80, 0x80, 0x80, 0x80, 0xc0, 0x80, 0x80, 0x80, 0x80, 0xe0, 0x80, 0x80, 0x80, 0x80, 0xc0, 0x80, 
    0x80, 0x80, 0x80, 0xe0, 0x80, 0x80, 0x80, 0x80, 0xc0, 0x80, 0x81, 0x80, 0x81, 0xe0, 0x81, 0x80, 
    0x80, 0x87, 0xc8, 0x87, 0x80, 0x80, 0x81, 0xe0, 0x81, 0x80, 0x81, 0x80, 0xc0, 0xa0, 0xa1, 0xff
  };

  switch (oled_state)
  {
    case OLED_TEXT:
      oled_write_P(PSTR("Hello, World!"), false);
      break;
    case OLED_TEST:
      oled_write_raw_P(test_image, sizeof(test_image));
      break;
  }
  
  return false;
}

#endif // OLED_ENABLE